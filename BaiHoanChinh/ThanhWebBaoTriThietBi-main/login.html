<!DOCTYPE html>
<html lang="vi" ng-app="AppQuanLyBaoTri" ng-controller="LoginCtrl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ƒêƒÉng nh·∫≠p - H·ªá th·ªëng B·∫£o tr√¨</title>

  <base href="./">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

  <style>
    body { background: #f3f4f6; }
    .login-card {
      background: white;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 420px;
    }
  </style>
</head>

<body class="h-screen flex justify-center items-center">

  <div class="login-card">
    <h2 class="text-2xl font-bold text-center text-blue-600 mb-6">
      ƒêƒÉng nh·∫≠p h·ªá th·ªëng
    </h2>

    <form ng-submit="login()">

      <label class="block mb-2 text-gray-700 font-medium">T√™n ƒëƒÉng nh·∫≠p</label>
      <input type="text" ng-model="username" required
             class="w-full mb-4 border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500">

      <label class="block mb-2 text-gray-700 font-medium">M·∫≠t kh·∫©u</label>

      <!-- INPUT + ICON SVG KH√ìA -->
      <div class="relative mb-6">
        <input id="passwordInput"
               type="password"
               ng-model="password"
               required
               class="w-full border rounded px-3 py-2 pr-12 focus:ring-2 focus:ring-blue-500">

        <!-- ICON SVG KH√ìA - CH√çNH GI·ªÆA -->
        <span id="togglePassword"
              class="absolute right-3 top-1/2 -translate-y-1/2 cursor-pointer select-none flex items-center">

          <svg id="lockIcon" xmlns="http://www.w3.org/2000/svg"
               fill="none" viewBox="0 0 24 24" stroke-width="2"
               stroke="#2563eb" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M16 10V7a4 4 0 10-8 0v3m-2 0h12a2 2 0 012 2v7a2 2 0 01-2 2H6a2 2 0 01-2-2v-7a2 2 0 012-2z" />
          </svg>

        </span>
      </div>

      <button type="submit"
              class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
        ƒêƒÉng nh·∫≠p
      </button>
    </form>

    <p class="text-center mt-4">
      <a href="forgot.html" class="text-blue-600 hover:underline">
        Qu√™n m·∫≠t kh·∫©u?
      </a>
    </p>

    <p class="text-center text-gray-500 text-sm mt-4">
      ¬© 2025 - H·ªá th·ªëng Qu·∫£n l√Ω B·∫£o tr√¨
    </p>
  </div>

  <!-- ========================================= -->
  <!-- CODE ANGULARJS + HI·ªÜN/·∫®N M·∫¨T KH·∫®U -->
  <!-- ========================================= -->
  <script>
    // AngularJS App
    var app = angular.module("AppQuanLyBaoTri", []);

    app.controller("LoginCtrl", function ($scope, $http) {
      const API_URL = "https://localhost:44310/api/TaiKhoan/get-all";

      $scope.username = "";
      $scope.password = "";

      // H√†m ƒëƒÉng nh·∫≠p
      $scope.login = function () {
        if (!$scope.username || !$scope.password) {
          alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p t√™n ƒëƒÉng nh·∫≠p v√† m·∫≠t kh·∫©u!");
          return;
        }

        $http.get(API_URL).then(
          function (res) {
            const users = res.data || [];
            const user = users.find(
              (u) =>
                u.tenDangNhap === $scope.username &&
                u.matKhauHash === $scope.password
            );

            if (!user) {
              alert("‚ùå Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!");
              return;
            }

            if (user.trangThai === "Kh√≥a") {
              alert("üîí T√†i kho·∫£n ƒë√£ b·ªã kh√≥a!");
              return;
            }

            localStorage.setItem("userLogin", JSON.stringify(user));
            localStorage.setItem("userRole", user.role);
            alert("‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
            window.location.href = "./dashboard.html";
          },
          function (err) {
            console.error("‚ùå L·ªói:", err);
            alert("‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server!");
          }
        );
      };
    });

    // ========================================
    // HI·ªÜN/·∫®N M·∫¨T KH·∫®U - CH·∫†Y KHI HTML LOAD XONG
    // ========================================
    window.addEventListener("load", function() {
      const toggleBtn = document.getElementById("togglePassword");
      const inputPass = document.getElementById("passwordInput");
      const iconLock = document.getElementById("lockIcon");

      if (toggleBtn && inputPass && iconLock) {
        toggleBtn.addEventListener("click", function () {
          // Ki·ªÉm tra ƒëang ·∫©n hay hi·ªán
          const isHidden = inputPass.type === "password";

          if (isHidden) {
            // Hi·ªán m·∫≠t kh·∫©u
            inputPass.type = "text";
            // Icon m·ªü kh√≥a
            iconLock.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M12 1v11m4-4H8m12 4v7a2 2 0 01-2 2H6a2 2 0 01-2-2v-7a2 2 0 012-2h12a2 2 0 012 2z"/>`;
          } else {
            // ·∫®n m·∫≠t kh·∫©u
            inputPass.type = "password";
            // Icon kh√≥a
            iconLock.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M16 10V7a4 4 0 10-8 0v3m-2 0h12a2 2 0 012 2v7a2 2 0 01-2 2H6a2 2 0 01-2-2v-7a2 2 0 012-2z"/>`;
          }

          console.log("‚úÖ ƒê√£ ƒë·ªïi type th√†nh:", inputPass.type);
        });
      } else {
        console.error("‚ùå Kh√¥ng t√¨m th·∫•y element!");
      }
    });
  </script>

</body>
</html>